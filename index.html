<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <input type="file" id="input" multiple><br>
  <button id="btn-louder">louder</button>
  <button id="btn-reset-volume">reset</button>
  <button id="btn-quieter">quieter</button>
  <span id="span-volume"></span>
  <br>
  <button id="btn-previous">previous</button>
  <button id="btn-next">next</button><br>
  <span id="span-playing"></span>
  <br>
  <video id="player" controls="true" loop="true"></video>
  <script>
   (() => {
    let fileList = [];
    const inputElement = document.getElementById("input");
    const playerElement = document.getElementById("player");
    
    const btnLouder = document.getElementById("btn-louder");
    const btnResetVolume = document.getElementById("btn-reset-volume");
    const btnQuieter = document.getElementById("btn-quieter");

    const spanVolume = document.getElementById("span-volume");
    const spanPlaying = document.getElementById("span-playing");

    const btnPrevious = document.getElementById("btn-previous");
    const btnNext = document.getElementById("btn-next");
    
    const playIdxHelper = (function () {
      let idx = 0;
      return {
        prev: function () {
          idx = Math.max(idx - 1, 0);
          this.play();
        },
        next: function () {
          idx = (idx + 1) % (fileList || []).length;
          this.play();
        },
        play: function () {
          playerElement.src = URL.createObjectURL(fileList[idx]);
          spanPlaying.innerText = fileList[idx].name;
          playerElement.play();
        }
      }
    })();

    let audioContext = undefined;
    let sourceNode = undefined;
    let gainNode = undefined;
    

    inputElement.addEventListener("change", function () {
      fileList = [...this.files];

      if (!audioContext) {
        audioContext = new AudioContext();
        sourceNode = audioContext.createMediaElementSource(playerElement);
        gainNode = audioContext.createGain();
        sourceNode.connect(gainNode);
        gainNode.connect(audioContext.destination);
      }

      playIdxHelper.play();
    }, false);


    btnLouder.addEventListener("click", function () {
      gainNode.gain.value += 0.2;
      spanVolume.innerText = gainNode.gain.value;
    });

    btnResetVolume.addEventListener("click", function () {
      gainNode.gain.value = 1;
      spanVolume.innerText = gainNode.gain.value;
    });

    btnQuieter.addEventListener("click", function () {
      gainNode.gain.value = Math.max(gainNode.gain.value - 0.2, 0);
      spanVolume.innerText = gainNode.gain.value;
    });

    btnPrevious.addEventListener("click", function () {
      playIdxHelper.prev();
    });

    btnNext.addEventListener("click", function () {
      playIdxHelper.next();
    });
   })();
  



/*


    
  // Define your array of time ranges
  const timeRanges = [
    { start: 0, end: 2 },   // Range 1: 0s to 10s
    { start: 4, end: 6 }
  ];
  

  const sorted = timeRanges.sort((a, b) => {
  	return a.start - b.start;
  });
    
  // Add an event listener to the 'timeupdate' event of the video element
  playerElement.addEventListener('timeupdate', () => {
    // Get the current playback time of the video
    const currentTime = playerElement.currentTime;
  
    // Check if the current time is within any of the time ranges
    const isInTimeRange = timeRanges.some(range => {
      return currentTime >= range.start && currentTime <= range.end
    });
    
    
    if (!isInTimeRange) {
    	let should = sorted.reduce((p, c, currentIndex) => {
      	if (currentTime > p && currentTime < c.start) {
          	return c.start
          } else {
          	return c.end
          }
      }, 0);
      
       if (should === timeRanges[timeRanges.length -1].end) {
        should = timeRanges[0].start
      }
      
      playerElement.currentTime = should;
  
      // console.log(`${currentTime} ${should}`);
    }
  });
  */
  </script>
</body>

</html>
